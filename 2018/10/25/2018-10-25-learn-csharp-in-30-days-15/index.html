<!DOCTYPE html><html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="你好，我是米歐，歡迎來到我的部落格:)"><meta property="og:title" content="MMiooiMM"><meta property="og:description" content="你好，我是米歐，歡迎來到我的部落格:)"><meta property="og:image" content="https://raw.githubusercontent.com/MMiooiMM/MMiooiMM.github.io/master/images/VeryImportantFile.jpg"><title>.NET 後端起手式 30天認識 C# - Day 15 類別(四) | MMiooiMM</title><link rel="stylesheet" type="text/css" href="/css/normalize.css"><link rel="stylesheet" type="text/css" href="/css/highlight.css"><link rel="stylesheet" type="text/css" href="/css/font.css"><link rel="stylesheet" type="text/css" href="/css/noise.css"><link rel="stylesheet" type="text/css" href="/css/mio.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><meta name="generator" content="Hexo 4.2.1"></head><body><article class="wrapper"><div class="post-main"><div class="nav"><nav class="container"><a class="sidebar-nav-item active" href="/">Home</a><a class="sidebar-nav-item" href="/archives">Archives</a><a class="sidebar-nav-item" href="/about">About</a></nav><div class="container post-meta"><div class="post-tags"><a class="post-tag-link" href="/tags/2019-iT-%E9%82%A6%E5%B9%AB%E5%BF%99%E9%90%B5%E4%BA%BA%E8%B3%BD/" rel="tag">2019 iT 邦幫忙鐵人賽</a><a class="post-tag-link" href="/tags/CSharp/" rel="tag">CSharp</a></div><div class="post-time">2018-10-25</div></div></div><div class="container post-header"><h1>.NET 後端起手式 30天認識 C# - Day 15 類別(四)</h1></div><div class="container post-content"><h2 id="DAY-15-類別-四"><a href="#DAY-15-類別-四" class="headerlink" title="DAY 15 類別(四)"></a>DAY 15 類別(四)</h2><h3 id="類別"><a href="#類別" class="headerlink" title="類別"></a>類別</h3><p>如果把繼承也算上去的話，今天就是第六天的類別介紹了，在把類別講得更完整吧！</p>
<h3 id="優化類別"><a href="#優化類別" class="headerlink" title="優化類別"></a>優化類別</h3><p>還記得在 DAY 10 隨口提到的類別的基底類別是 object，所以我們自己做的類別，實作後也都有 object 的方法，但由於我們沒有在再定義內容，所以有些方法可能不能用，或者不如預期，所以今天來把這些方法弄完整。</p>
<p>那我們來做一個座標類別來示範</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title">Coordinate</span> &#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">Coordinate</span> (<span class="params"><span class="keyword">decimal</span> longitude, <span class="keyword">decimal</span> latitude</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">this</span>.longitude = longitude;</span><br><span class="line">    <span class="keyword">this</span>.latitude = latitude;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">decimal</span> longitude &#123; <span class="keyword">get</span>; &#125;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">decimal</span> latitude &#123; <span class="keyword">get</span>; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="ToString"><a href="#ToString" class="headerlink" title="ToString"></a>ToString</h4><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Coordinate c1 = <span class="keyword">new</span> Coordinate (<span class="number">12.156</span>m, <span class="number">7.195</span>m);</span><br><span class="line">Console.WriteLine (c1);</span><br><span class="line">Console.ReadKey ();</span><br></pre></td></tr></table></figure>

<p>可以看到顯示的是<code>demo.Program+Coordinate</code>，因為我的命名空間是 demo，所以每個人看到的可能不一樣，但這資訊都是對我們沒有幫助的，我們希望 ToString 得內容應該要能正確地獲得類別相關資訊，所以我們要</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">string</span> <span class="title">ToString</span> (<span class="params"></span>)</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">$"longitude: <span class="subst">&#123;longitude&#125;</span>, latitude: <span class="subst">&#123;latitude&#125;</span>"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>因為 Console.WriteLine() 方法會呼叫對象的 ToString() 方法，而 object.ToString() 預設輸出類別名稱，就會發生印出不需要的內容，所以把 ToString 改成是轉出我們的相關成員的字串，之後印出這個類別就能得到有用的資訊。</p>
<h4 id="GetHashCode"><a href="#GetHashCode" class="headerlink" title="GetHashCode"></a>GetHashCode</h4><p>因為做比較時 Equals() 會警告你需先重寫 GetHashCode()，不寫不會讓程式編譯失敗，但寫好程式的幾個要點之一就是，程式執行後不要有任何的警告。</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">int</span> <span class="title">GetHashCode</span> (<span class="params"></span>)</span> &#123;</span><br><span class="line">  <span class="keyword">int</span> hashCode = longitude.GetHashCode ();</span><br><span class="line">  <span class="keyword">if</span> (longitude.GetHashCode () != latitude.GetHashCode ()) &#123;</span><br><span class="line">    hashCode ^= latitude.GetHashCode ();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> hashCode;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>簡單來說，只要經緯度一樣，我們就得到的 HashCode 就會是一樣，至於為什麼要用 xor(^) 來操作，因為如果是以相加減來說，較容易出現不同經緯而數值一樣的狀況，但使用 and 容易變成全是 0，or 容易全是 1，所以通常都是用 xor 來做 HashCode 的處理。</p>
<h4 id="Equals"><a href="#Equals" class="headerlink" title="Equals"></a>Equals</h4><p>有了 GetHashCode 後，我們就可以來比較類別了。</p>
<p>假設我們希望兩個物件只要內容一樣就表示相等，即便參考位置不一樣</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">Coordinate c1 = <span class="keyword">new</span> Coordinate (<span class="number">12.156</span>m, <span class="number">7.195</span>m);</span><br><span class="line">Coordinate c2 = c1;</span><br><span class="line">Coordinate c3 = <span class="keyword">new</span> Coordinate (<span class="number">12.156</span>m, <span class="number">7.195</span>m);</span><br><span class="line"><span class="keyword">if</span> (Coordinate.ReferenceEquals (c1, c2)) &#123;</span><br><span class="line">  Console.WriteLine (<span class="string">"c1 與 c2 參考位置相等"</span>);</span><br><span class="line">&#125; </span><br><span class="line"><span class="keyword">if</span> (c1.Equals (c2)) &#123;</span><br><span class="line">  Console.WriteLine (<span class="string">"c1 與 c2 相等"</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (Coordinate.ReferenceEquals (c1, c3)) &#123;</span><br><span class="line">  Console.WriteLine (<span class="string">"c1 與 c3 參考位置相等"</span>);</span><br><span class="line">&#125; </span><br><span class="line"><span class="keyword">if</span> (c1.Equals (c3)) &#123;</span><br><span class="line">  Console.WriteLine (<span class="string">"c1 與 c3 相等"</span>);</span><br><span class="line">&#125; </span><br><span class="line">Console.ReadKey ();</span><br></pre></td></tr></table></figure>

<p>可以看到 c1 一個也不跟 c3 相等，但我們希望 Equals() 時，顯示是 true，所以我們來改寫吧</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">bool</span> <span class="title">Equals</span> (<span class="params"><span class="keyword">object</span> obj</span>)</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (obj == <span class="literal">null</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">this</span>.GetType () != obj.GetType ())</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span>.GetHashCode () == obj.GetHashCode ();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>首先檢查 obj 是不是 null，再檢查型別一不一樣，然後就是用我們上面做過的方法，來確認值一不一樣。</p>
<p>但很多人可能使用 <code>==</code> 來比較多過於使用 Equals()，但你會發現 <code>(c1 == c3) == false</code> ，所以我們要來重寫運算子。</p>
<h4 id="比較運算子"><a href="#比較運算子" class="headerlink" title="比較運算子"></a>比較運算子</h4><p>我們就把<code>==</code>做成跟我們 Equals() 一樣，不管參考位置</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">bool</span> <span class="keyword">operator</span> == (Coordinate c1, Coordinate c2) &#123;</span><br><span class="line">  <span class="keyword">return</span> c1.Equals (c2);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">bool</span> <span class="keyword">operator</span> != (Coordinate c1, Coordinate c2) &#123;</span><br><span class="line">  <span class="keyword">return</span> !c1.Equals (c2);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>因為重寫 <code>==</code> 需要連同 <code>!=</code> 一起重寫，這樣我們就可以使用 <code>==</code> 來做比較了。</p>
<h4 id="加法類運算子"><a href="#加法類運算子" class="headerlink" title="加法類運算子"></a>加法類運算子</h4><p>再來就是加減的時候，能夠把經緯度相加減。</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> Coordinate <span class="keyword">operator</span> + (Coordinate c1, Coordinate c2) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> Coordinate (c1.longitude + c2.longitude, c1.latitude + c2.latitude);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> Coordinate <span class="keyword">operator</span> - (Coordinate c1, Coordinate c2) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> Coordinate (c1.longitude - c2.longitude, c1.latitude - c2.latitude);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>相加減後會傳回一個新的座標類別</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Coordinate c1 = <span class="keyword">new</span> Coordinate (<span class="number">12.156</span>m, <span class="number">7.195</span>m);</span><br><span class="line">Coordinate c2 = <span class="keyword">new</span> Coordinate (<span class="number">12.06</span>m, <span class="number">1.516</span>m);</span><br><span class="line">Console.WriteLine (c1 + c2);</span><br><span class="line">Console.ReadKey ();</span><br></pre></td></tr></table></figure>

<h3 id="一些小結論"><a href="#一些小結論" class="headerlink" title="一些小結論"></a>一些小結論</h3><p>今天只重寫了我覺得比較常用到的部分，還有很多很多的運算子可以重寫，就請大家自己練習了，最後附上這次完整的範例類別程式碼。</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title">Coordinate</span> &#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">Coordinate</span> (<span class="params"><span class="keyword">decimal</span> longitude, <span class="keyword">decimal</span> latitude</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">this</span>.longitude = longitude;</span><br><span class="line">    <span class="keyword">this</span>.latitude = latitude;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">decimal</span> longitude &#123; <span class="keyword">get</span>; &#125;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">decimal</span> latitude &#123; <span class="keyword">get</span>; &#125;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">string</span> <span class="title">ToString</span> (<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">$"longitude: <span class="subst">&#123;longitude&#125;</span>, latitude: <span class="subst">&#123;latitude&#125;</span>"</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">int</span> <span class="title">GetHashCode</span> (<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">int</span> hashCode = longitude.GetHashCode ();</span><br><span class="line">    <span class="keyword">if</span> (longitude.GetHashCode () != latitude.GetHashCode ()) &#123;</span><br><span class="line">      hashCode ^= latitude.GetHashCode ();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> hashCode;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">bool</span> <span class="title">Equals</span> (<span class="params"><span class="keyword">object</span> obj</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (obj == <span class="literal">null</span>)</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.GetType () != obj.GetType ())</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.GetHashCode () == obj.GetHashCode ();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">bool</span> <span class="keyword">operator</span> == (Coordinate c1, Coordinate c2) &#123;</span><br><span class="line">    <span class="keyword">return</span> c1.Equals (c2);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">bool</span> <span class="keyword">operator</span> != (Coordinate c1, Coordinate c2) &#123;</span><br><span class="line">    <span class="keyword">return</span> !c1.Equals (c2);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> Coordinate <span class="keyword">operator</span> + (Coordinate c1, Coordinate c2) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Coordinate (c1.longitude + c2.longitude, c1.latitude + c2.latitude);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> Coordinate <span class="keyword">operator</span> - (Coordinate c1, Coordinate c2) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Coordinate (c1.longitude - c2.longitude, c1.latitude - c2.latitude);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>感謝閱讀。</p>
</div></div><div class="post-main post-comment"><div id="disqus_thread"></div><script type="text/javascript">
var disqus_shortname = 'mio-blog';
var disqus_identifier = '2018/10/25/2018-10-25-learn-csharp-in-30-days-15/';
var disqus_title = '.NET 後端起手式 30天認識 C# - Day 15 類別(四)';
var disqus_url = 'http://yoursite.com/2018/10/25/2018-10-25-learn-csharp-in-30-days-15/';
(function() {
   var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
   dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
   (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript" target="_blank" rel="noopener">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" target="_blank" rel="noopener" class="dsq-brlink">Blog comments powered by <span class="logo-disqus">Disqus</span></a></div></article><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.css"><script src="//cdn.bootcss.com/jquery/2.0.3/jquery.min.js"></script><script src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js"></script><script>$(document).ready(function() {
  $(".fancybox").fancybox();
});
</script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=
function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;
e=o.createElement(i);r=o.getElementsByTagName(i)[0];
e.src='//www.google-analytics.com/analytics.js';
r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));
ga('create','UA-156431110-1');ga('send','pageview');</script></body></html>