<!DOCTYPE html><html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="你好，我是米歐，歡迎來到我的部落格:)"><meta property="og:title" content="MMiooiMM"><meta property="og:description" content="你好，我是米歐，歡迎來到我的部落格:)"><meta property="og:image" content="https://raw.githubusercontent.com/MMiooiMM/MMiooiMM.github.io/master/images/VeryImportantFile.jpg"><title>.NET 後端起手式 30天認識 C# - Day 27 特性 | MMiooiMM</title><link rel="stylesheet" type="text/css" href="/css/normalize.css"><link rel="stylesheet" type="text/css" href="/css/highlight.css"><link rel="stylesheet" type="text/css" href="/css/font.css"><link rel="stylesheet" type="text/css" href="/css/noise.css"><link rel="stylesheet" type="text/css" href="/css/mio.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><meta name="generator" content="Hexo 4.2.1"></head><body><article class="wrapper"><div class="post-main"><div class="nav"><nav class="container"><a class="sidebar-nav-item active" href="/">Home</a><a class="sidebar-nav-item" href="/archives">Archives</a><a class="sidebar-nav-item" href="/about">About</a></nav><div class="container post-meta"><div class="post-tags"><a class="post-tag-link" href="/tags/2019-iT-%E9%82%A6%E5%B9%AB%E5%BF%99%E9%90%B5%E4%BA%BA%E8%B3%BD/" rel="tag">2019 iT 邦幫忙鐵人賽</a><a class="post-tag-link" href="/tags/CSharp/" rel="tag">CSharp</a></div><div class="post-time">2018-11-06</div></div></div><div class="container post-header"><h1>.NET 後端起手式 30天認識 C# - Day 27 特性</h1></div><div class="container post-content"><h2 id="DAY-27-特性"><a href="#DAY-27-特性" class="headerlink" title="DAY 27 特性"></a>DAY 27 特性</h2><h3 id="特性"><a href="#特性" class="headerlink" title="特性"></a>特性</h3><blockquote>
<p>屬性提供以宣告方式將資訊與程式碼相關聯的方法。<br>它們也可提供可重複使用的元素，以套用至各種不同的目標。<br>屬性是繼承自 Attribute 基底類別的類別。<br>繼承自 Attribute 的任何類別都能在其他程式碼片段上做為一種「標記」。</p>
</blockquote>
<p>Attribute 有人叫做屬性，也有人叫做特性，為了與 Property 區隔，本系列文就叫特性，雖然本人習慣上是叫屬性。</p>
<p>特性是將額外內容透過反射的方式給予目標，根據官方的解釋，目標有以下這些</p>
<ul>
<li>Assembly</li>
<li>類別</li>
<li>建構函式</li>
<li>Delegate - 委派</li>
<li>列舉</li>
<li>Event - 事件</li>
<li>欄位</li>
<li>GenericParameter</li>
<li>介面</li>
<li>方法</li>
<li>Module</li>
<li>參數</li>
<li>屬性</li>
<li>ReturnValue</li>
<li>結構</li>
</ul>
<p>簡單的示範一下特性的用法，並套用在我們的類別</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title">Member</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">int</span> ID &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line"></span><br><span class="line">  [<span class="meta">My (12)</span>]</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">string</span> Name &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Print</span> (<span class="params"></span>)</span> &#123;</span><br><span class="line">    Console.WriteLine (<span class="string">$"ID = <span class="subst">&#123;ID&#125;</span>, Name = <span class="subst">&#123;Name&#125;</span>"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title">MyAttribute</span> : <span class="title">Attribute</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">int</span> Length &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">MyAttribute</span> (<span class="params"><span class="keyword">int</span> length</span>)</span> &#123;</span><br><span class="line">    Length = length;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以看到屬性 Name 上面多了 [My (12)]，特性以 [] 括弧內容表示使用哪一個特性，並標住在目標上方。</p>
<p>在建立特性時，只要繼承 Attribute 即可當作特性，建議是加入 Attribute 當作名詞後綴，當你用這種方式取名，可以看到雖然特性名稱是 MyAttribute，但使用時可以省略 Attribute 字詞，當然也方便別人一眼就能認出你寫的就是特性。</p>
<p>如果只是單純的加特性，可以發現程式碼其實沒什麼變動，假如我們想要有一個來驗證屬性不大於 Length 的方法，如</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title">MyAttribute</span> : <span class="title">Attribute</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">int</span> Length &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">MyAttribute</span> (<span class="params"><span class="keyword">int</span> length</span>)</span> &#123;</span><br><span class="line">    Length = length;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">bool</span> <span class="title">IsValid</span> (<span class="params"><span class="keyword">object</span> obj, <span class="keyword">string</span> prop</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> property = obj.GetType ().GetProperty (prop);</span><br><span class="line">    <span class="keyword">if</span> (property <span class="keyword">is</span> <span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">var</span> <span class="keyword">value</span> = (<span class="keyword">object</span>) property.GetValue (obj, <span class="literal">null</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">value</span> <span class="keyword">is</span> <span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">var</span> attr = (MyAttribute) property.GetCustomAttribute (<span class="keyword">typeof</span> (MyAttribute), <span class="literal">false</span>);</span><br><span class="line">    <span class="keyword">if</span> (attr <span class="keyword">is</span> <span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">var</span> length = attr.Length;</span><br><span class="line">    <span class="keyword">return</span> ((<span class="keyword">string</span>) <span class="keyword">value</span>).Length &lt;= length;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>請注意範例可能寫得不是很好，或者真實用法不是長這樣。</strong></p>
<p>IsValid 方法就是</p>
<ol>
<li><p>將參數的 obj 轉換成 Type 類型並且獲得與 prop 名稱一樣的屬性資訊 property，若無則傳回 false。</p>
</li>
<li><p>將 property 的值給予 value，若 value 為空則傳回 false。</p>
</li>
<li><p>在 property 的特性中取得名稱 MyAttribute 的特性 attr，若找不到符合特性則傳回 false。</p>
</li>
<li><p>比較特性 attr 中輸入的值，也就是 My (12) 的 12 是不是大於物件 obj 的屬性 prop 長度。</p>
</li>
</ol>
<p>第三點中，因為特性不是只能有一個，但同特性只能有一個，所以在取特性時，也可以一次取出所有特性，GetCustomAttributes () 傳回的是陣列。</p>
<p>若要多個特性可以寫成</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">My (12)</span>]</span><br><span class="line">[<span class="meta">My2 (20)</span>]</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">string</span> Name &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br></pre></td></tr></table></figure>

<p>或者是</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">My (12), My2 (20)</span>]</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">string</span> Name &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br></pre></td></tr></table></figure>

<p>再來就是使用這個驗證方法，如</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> members = <span class="keyword">new</span> List&lt;Member&gt; () &#123;</span><br><span class="line">  <span class="keyword">new</span> Member () &#123; ID = <span class="number">0</span>, Name = <span class="string">"Mio"</span> &#125;,</span><br><span class="line">  <span class="keyword">new</span> Member () &#123; ID = <span class="number">1</span>, Name = <span class="string">"Miffy"</span> &#125;,</span><br><span class="line">  <span class="keyword">new</span> Member () &#123; ID = <span class="number">2</span>, Name = <span class="string">"Lulu"</span> &#125;,</span><br><span class="line">  <span class="keyword">new</span> Member () &#123; ID = <span class="number">3</span>, Name = <span class="string">"NekoSan"</span> &#125;,</span><br><span class="line">  <span class="keyword">new</span> Member () &#123; ID = <span class="number">3</span>, Name = <span class="string">"MooDoooooooooooooooooo"</span> &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span> (<span class="keyword">var</span> member <span class="keyword">in</span> members) &#123;</span><br><span class="line">  Console.WriteLine (<span class="string">$"Name = <span class="subst">&#123;member.Name&#125;</span>, IsValid = <span class="subst">&#123;MyAttribute.IsValid (member, <span class="string">"Name"</span>)&#125;</span>"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="特性的特性"><a href="#特性的特性" class="headerlink" title="特性的特性"></a>特性的特性</h3><p>有類別的類別，當然也有特性的特性囉，特性的特性可以限定特性使用在哪一個目標上，如</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">AttributeUsage (AttributeTargets.Class)</span>]</span><br><span class="line"><span class="keyword">class</span> <span class="title">MyAttribute</span> : <span class="title">Attribute</span> &#123;</span><br><span class="line">  <span class="comment">//...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以看到瞬間出現紅字，只要多加<code>AttributeTargets.Property</code>就可以在我們的屬性上使用了。</p>
<h3 id="一些小結論"><a href="#一些小結論" class="headerlink" title="一些小結論"></a>一些小結論</h3><p>特性的使用可以把一些額外的資訊附加在目標上，例如我忘記在哪邊看到的程式碼維護程度，把特性當作一個 TAG，讓維護的人知道這裡有多大的坑，並無實際操作特性內容。</p>
<p>感謝閱讀，今天的內容可能有誤，閱讀後請再三求證喔。</p>
<p>參考資料<br><a href="https://docs.microsoft.com/zh-tw/dotnet/csharp/tutorials/attributes" target="_blank" rel="noopener">屬性 - C# | Microsoft Docs</a><br><a href="https://hk.saowen.com/a/f4089964b8987b5f9b117258a21994cb2052ed452634810e6a21089f8b09c105" target="_blank" rel="noopener">C#屬性(Attribute)用法實例解析 - 掃文資訊</a></p>
</div></div><div class="post-main post-comment"><div id="disqus_thread"></div><script type="text/javascript">
var disqus_shortname = 'mio-blog';
var disqus_identifier = '2018/11/06/2018-11-06-learn-csharp-in-30-days-27/';
var disqus_title = '.NET 後端起手式 30天認識 C# - Day 27 特性';
var disqus_url = 'http://yoursite.com/2018/11/06/2018-11-06-learn-csharp-in-30-days-27/';
(function() {
   var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
   dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
   (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript" target="_blank" rel="noopener">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" target="_blank" rel="noopener" class="dsq-brlink">Blog comments powered by <span class="logo-disqus">Disqus</span></a></div></article><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.css"><script src="//cdn.bootcss.com/jquery/2.0.3/jquery.min.js"></script><script src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js"></script><script>$(document).ready(function() {
  $(".fancybox").fancybox();
});
</script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=
function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;
e=o.createElement(i);r=o.getElementsByTagName(i)[0];
e.src='//www.google-analytics.com/analytics.js';
r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));
ga('create','UA-156431110-1');ga('send','pageview');</script></body></html>