<!DOCTYPE html><html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="你好，我是米歐，歡迎來到我的部落格:)"><meta property="og:title" content="MMiooiMM"><meta property="og:description" content="你好，我是米歐，歡迎來到我的部落格:)"><meta property="og:image" content="https://raw.githubusercontent.com/MMiooiMM/MMiooiMM.github.io/master/images/VeryImportantFile.jpg"><title>.NET 後端起手式 30天認識 C# - Day 23 LINQ 查詢運算式(二) | MMiooiMM</title><link rel="stylesheet" type="text/css" href="/css/normalize.css"><link rel="stylesheet" type="text/css" href="/css/highlight.css"><link rel="stylesheet" type="text/css" href="/css/font.css"><link rel="stylesheet" type="text/css" href="/css/noise.css"><link rel="stylesheet" type="text/css" href="/css/mio.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><meta name="generator" content="Hexo 4.2.1"></head><body><article class="wrapper"><div class="post-main"><div class="nav"><nav class="container"><a class="sidebar-nav-item active" href="/">Home</a><a class="sidebar-nav-item" href="/archives">Archives</a><a class="sidebar-nav-item" href="/about">About</a></nav><div class="container post-meta"><div class="post-tags"><a class="post-tag-link" href="/tags/2019-iT-%E9%82%A6%E5%B9%AB%E5%BF%99%E9%90%B5%E4%BA%BA%E8%B3%BD/" rel="tag">2019 iT 邦幫忙鐵人賽</a><a class="post-tag-link" href="/tags/CSharp/" rel="tag">CSharp</a></div><div class="post-time">2018-11-02</div></div></div><div class="container post-header"><h1>.NET 後端起手式 30天認識 C# - Day 23 LINQ 查詢運算式(二)</h1></div><div class="container post-content"><h2 id="DAY-23-LINQ-查詢運算式-二"><a href="#DAY-23-LINQ-查詢運算式-二" class="headerlink" title="DAY 23 LINQ 查詢運算式(二)"></a>DAY 23 LINQ 查詢運算式(二)</h2><h3 id="LINQ"><a href="#LINQ" class="headerlink" title="LINQ"></a>LINQ</h3><p>來繼續簡單介紹 LINQ 的功能吧。</p>
<h3 id="Take-amp-Skip"><a href="#Take-amp-Skip" class="headerlink" title="Take &amp; Skip"></a>Take &amp; Skip</h3><p>這兩種都是對集合內的元素依排序操作的方法，所以使用前通常會先 OrderBy，以下四種方法都是給予一個 int 引數，若 int 大於集合數量也不會產生錯誤。</p>
<h4 id="Take"><a href="#Take" class="headerlink" title="Take"></a>Take</h4><p>Take 集合現有排序中取出前幾個元素，如</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span>[] scores = <span class="keyword">new</span> <span class="keyword">int</span>[] &#123; <span class="number">97</span>, <span class="number">92</span>, <span class="number">81</span>, <span class="number">60</span> &#125;;</span><br><span class="line"><span class="keyword">var</span> scoresTakeTop3 = scores.Take (<span class="number">3</span>);</span><br></pre></td></tr></table></figure>

<h4 id="TakeLast"><a href="#TakeLast" class="headerlink" title="TakeLast"></a>TakeLast</h4><p>TakeLast 集合現有排序中取出後幾個元素，元素排序依照原排序，如</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span>[] scores = <span class="keyword">new</span> <span class="keyword">int</span>[] &#123; <span class="number">97</span>, <span class="number">92</span>, <span class="number">81</span>, <span class="number">60</span> &#125;;</span><br><span class="line"><span class="keyword">var</span> scoresTakeLast3 = scores.TakeLast (<span class="number">3</span>);</span><br></pre></td></tr></table></figure>

<h4 id="Skip"><a href="#Skip" class="headerlink" title="Skip"></a>Skip</h4><p>Skip 集合現有排序中跳過幾個元素後取出，如</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span>[] scores = <span class="keyword">new</span> <span class="keyword">int</span>[] &#123; <span class="number">97</span>, <span class="number">92</span>, <span class="number">81</span>, <span class="number">60</span> &#125;;</span><br><span class="line"><span class="keyword">var</span> scoresSkipTop3 = scores.Skip (<span class="number">3</span>);</span><br></pre></td></tr></table></figure>

<h4 id="SkipLast"><a href="#SkipLast" class="headerlink" title="SkipLast"></a>SkipLast</h4><p>SkipLast 集合現有排序中跳過後幾個元素後取出，如</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span>[] scores = <span class="keyword">new</span> <span class="keyword">int</span>[] &#123; <span class="number">97</span>, <span class="number">92</span>, <span class="number">81</span>, <span class="number">60</span> &#125;;</span><br><span class="line"><span class="keyword">var</span> scoresSkipLast3 = scores.SkipLast (<span class="number">3</span>);</span><br></pre></td></tr></table></figure>

<h3 id="First-amp-Single"><a href="#First-amp-Single" class="headerlink" title="First &amp; Single"></a>First &amp; Single</h3><p>這兩種都是使集合傳回一筆元素的方法。</p>
<h4 id="First"><a href="#First" class="headerlink" title="First"></a>First</h4><p>First 取出集合內的第一筆元素，或添加 Predicate 的多載方法，如</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span>[] scores = <span class="keyword">new</span> <span class="keyword">int</span>[] &#123; <span class="number">97</span>, <span class="number">92</span>, <span class="number">81</span>, <span class="number">60</span> &#125;;</span><br><span class="line"><span class="keyword">var</span> scoresFirst = scores.First ();</span><br><span class="line"><span class="keyword">var</span> scoresFirstLessThan90 = scores.First (x =&gt; x &lt; <span class="number">90</span>);</span><br></pre></td></tr></table></figure>

<p>但是，<strong>如果集合是空集合或者集合內並無任何一筆符合則會報錯</strong>，我們則需改用以下方式</p>
<h4 id="FirstOrDefault"><a href="#FirstOrDefault" class="headerlink" title="FirstOrDefault"></a>FirstOrDefault</h4><p>FirstOrDefault 當集合內取不出第一筆元素時，則傳回 default (T)，一樣有有無添加 Predicate 的兩種多載方法。</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span>[] scores = <span class="keyword">new</span> <span class="keyword">int</span>[] &#123; <span class="number">97</span>, <span class="number">92</span>, <span class="number">81</span>, <span class="number">60</span> &#125;;</span><br><span class="line"><span class="keyword">var</span> scoresFirstMoreThan900 = scores.FirstOrDefault (x =&gt; x &gt; <span class="number">900</span>);</span><br></pre></td></tr></table></figure>

<h4 id="Single"><a href="#Single" class="headerlink" title="Single"></a>Single</h4><p>Single <strong>如果集合內的元素不是一筆則會報錯</strong>，一樣有兩種多載方法。</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span>[] scores = <span class="keyword">new</span> <span class="keyword">int</span>[] &#123; <span class="number">97</span>, <span class="number">92</span>, <span class="number">81</span>, <span class="number">60</span> &#125;;</span><br><span class="line"><span class="keyword">var</span> score = scores.Single (); <span class="comment">// 錯誤示範</span></span><br><span class="line"><span class="keyword">var</span> scoreMoreThan95 = scores.Single (x =&gt; x &gt; <span class="number">95</span>);</span><br></pre></td></tr></table></figure>

<p>也有相對應的傳回泛型預設值版本</p>
<h4 id="SingleOrDeafault"><a href="#SingleOrDeafault" class="headerlink" title="SingleOrDeafault"></a>SingleOrDeafault</h4><p>SingleOrDeafault <strong>如果集合內的元素大於一筆則會報錯</strong>，空集合則會傳回泛型預設值，一樣有兩種多載方法。</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span>[] scores = <span class="keyword">new</span> <span class="keyword">int</span>[] &#123; <span class="number">97</span>, <span class="number">92</span>, <span class="number">81</span>, <span class="number">60</span> &#125;;</span><br><span class="line"><span class="keyword">var</span> score = scores.SingleOrDefault (x =&gt; x &gt; <span class="number">900</span>);</span><br></pre></td></tr></table></figure>

<h3 id="Any-amp-All-amp-Contains"><a href="#Any-amp-All-amp-Contains" class="headerlink" title="Any &amp; All &amp; Contains"></a>Any &amp; All &amp; Contains</h3><p>這三種都是檢查集合內元素的方法，並傳回 bool。</p>
<h4 id="Any"><a href="#Any" class="headerlink" title="Any"></a>Any</h4><p>Any 檢查有無任何一個元素符合條件，但不加任何 Predicate 則代表檢查是否空集合，如</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span>[] scores = <span class="keyword">new</span> <span class="keyword">int</span>[] &#123; <span class="number">97</span>, <span class="number">92</span>, <span class="number">81</span>, <span class="number">60</span> &#125;;</span><br><span class="line"><span class="keyword">var</span> isScoresAny = scores.Any ();</span><br><span class="line"><span class="keyword">var</span> isScoresAnyMoreThan77 = scores.Any (x =&gt; x &gt; <span class="number">77</span>);</span><br></pre></td></tr></table></figure>

<h4 id="All"><a href="#All" class="headerlink" title="All"></a>All</h4><p>All 檢查集合內元素皆符合條件，因為一定要有條件，所以這個方法沒有無 Predicate 的方法，如</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span>[] scores = <span class="keyword">new</span> <span class="keyword">int</span>[] &#123; <span class="number">97</span>, <span class="number">92</span>, <span class="number">81</span>, <span class="number">60</span> &#125;;</span><br><span class="line"><span class="keyword">var</span> isScoresAllMoreThan70 = scores.All (x =&gt; x &gt; <span class="number">70</span>);</span><br></pre></td></tr></table></figure>

<h4 id="Contains"><a href="#Contains" class="headerlink" title="Contains"></a>Contains</h4><p>Contains 是檢查集合內是否擁有某個相同類型的元素，如</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span>[] scores = <span class="keyword">new</span> <span class="keyword">int</span>[] &#123; <span class="number">97</span>, <span class="number">92</span>, <span class="number">81</span>, <span class="number">60</span> &#125;;</span><br><span class="line"><span class="keyword">var</span> scoresContains900 = scores.Contains (<span class="number">900</span>);</span><br></pre></td></tr></table></figure>

<p>因為比較的不是集合本身，而是外部的物件，所以本來是不想放在這裡，但考量傳回值都是 bool，所以放到最後面並說明差異。</p>
<h3 id="Join"><a href="#Join" class="headerlink" title="Join"></a>Join</h3><p>Join 是將兩個集合合併成一個新集合，如</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span>[] scores = <span class="keyword">new</span> <span class="keyword">int</span>[] &#123; <span class="number">97</span>, <span class="number">92</span>, <span class="number">81</span>, <span class="number">60</span> &#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> members = <span class="keyword">new</span> List&lt;Member&gt; () &#123;</span><br><span class="line">  <span class="keyword">new</span> Member () &#123; ID = <span class="number">0</span>, Name = <span class="string">"Mio"</span> &#125;,</span><br><span class="line">  <span class="keyword">new</span> Member () &#123; ID = <span class="number">1</span>, Name = <span class="string">"Miffy"</span> &#125;,</span><br><span class="line">  <span class="keyword">new</span> Member () &#123; ID = <span class="number">2</span>, Name = <span class="string">"Lulu"</span> &#125;,</span><br><span class="line">  <span class="keyword">new</span> Member () &#123; ID = <span class="number">3</span>, Name = <span class="string">"NekoSan"</span> &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> scoresAddNo = scores</span><br><span class="line">  .Select ((x, y) =&gt; <span class="keyword">new</span> &#123; score = x, No = y &#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> scoresJoinMember = scoresAddNo</span><br><span class="line">  .Join (members,</span><br><span class="line">    score =&gt; <span class="keyword">new</span> &#123; ID = score.No &#125;,</span><br><span class="line">    member =&gt; <span class="keyword">new</span> &#123; ID = member.ID &#125;,</span><br><span class="line">    (score, member) =&gt; <span class="keyword">new</span> &#123;</span><br><span class="line">      ID = score.No,</span><br><span class="line">      Name = member.Name,</span><br><span class="line">      Score = score.score</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure>

<p>合併時，要注意<strong>傳入的值若為 null 就會報錯</strong>，那這邊就來講解一下引數作用。</p>
<p>第一個當然就是欲合併的集合。</p>
<p>第二個則是傳入合併的集合元素並給出任意類型的 Join Key。</p>
<p>第三個則是傳入欲合併的集合並給出與第二個 Join Key 一樣類型的 Join Key，我這邊雖然只有一個 Key，但寫成相同的匿名類型，在日後使用時疑問不會這麼多。當然如同前面所說 score 與 member 這名稱都可以自己替換。</p>
<p>第四個則是傳回的新集合，傳入合併與欲合併的集合，並傳回想要的成員。</p>
<h3 id="GroupBy"><a href="#GroupBy" class="headerlink" title="GroupBy"></a>GroupBy</h3><p>GroupBy 是將集合依照相關成員進行分群，如</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> members = <span class="keyword">new</span> List&lt;Member&gt; () &#123;</span><br><span class="line">  <span class="keyword">new</span> Member () &#123; ID = <span class="number">0</span>, Name = <span class="string">"Mio"</span> &#125;,</span><br><span class="line">  <span class="keyword">new</span> Member () &#123; ID = <span class="number">1</span>, Name = <span class="string">"Miffy"</span> &#125;,</span><br><span class="line">  <span class="keyword">new</span> Member () &#123; ID = <span class="number">2</span>, Name = <span class="string">"Lulu"</span> &#125;,</span><br><span class="line">  <span class="keyword">new</span> Member () &#123; ID = <span class="number">3</span>, Name = <span class="string">"NekoSan"</span> &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> membersGroupByFirstChar = members.GroupBy (x =&gt; x.Name.First ());</span><br></pre></td></tr></table></figure>

<p>可以看到總共分成三個 L、M、N 開頭的群組， M 群裡面有兩個集合，其他則是一個，而當成分群條件的則變成該群的 Key，所以這邊示範一下</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> members = <span class="keyword">new</span> List&lt;Member&gt; () &#123;</span><br><span class="line">  <span class="keyword">new</span> Member () &#123; ID = <span class="number">0</span>, Name = <span class="string">"Mio"</span> &#125;,</span><br><span class="line">  <span class="keyword">new</span> Member () &#123; ID = <span class="number">1</span>, Name = <span class="string">"Miffy"</span> &#125;,</span><br><span class="line">  <span class="keyword">new</span> Member () &#123; ID = <span class="number">2</span>, Name = <span class="string">"Lulu"</span> &#125;,</span><br><span class="line">  <span class="keyword">new</span> Member () &#123; ID = <span class="number">3</span>, Name = <span class="string">"NekoSan"</span> &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span> (<span class="keyword">var</span> <span class="keyword">group</span> <span class="keyword">in</span> members.GroupBy (x =&gt; x.Name.First ())) &#123;</span><br><span class="line">  Console.WriteLine (<span class="keyword">group</span>.Key);</span><br><span class="line">  <span class="keyword">foreach</span> (<span class="keyword">var</span> member <span class="keyword">in</span> <span class="keyword">group</span>) &#123;</span><br><span class="line">    Console.WriteLine (<span class="string">$"\tID = <span class="subst">&#123;member.ID&#125;</span>, Name = <span class="subst">&#123;member.Name&#125;</span>"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="一些小結論"><a href="#一些小結論" class="headerlink" title="一些小結論"></a>一些小結論</h3><p>今天大致把比較常用的 LINQ 方法介紹完，當然還有很多東西沒提到，但 LINQ 的部分就到這裡了，當然其他方法想討論也可以在下面留言唷。</p>
<p>感謝閱讀。</p>
</div></div><div class="post-main post-comment"><div id="disqus_thread"></div><script type="text/javascript">
var disqus_shortname = 'mio-blog';
var disqus_identifier = '2018/11/02/2018-11-02-learn-csharp-in-30-days-23/';
var disqus_title = '.NET 後端起手式 30天認識 C# - Day 23 LINQ 查詢運算式(二)';
var disqus_url = 'http://yoursite.com/2018/11/02/2018-11-02-learn-csharp-in-30-days-23/';
(function() {
   var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
   dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
   (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript" target="_blank" rel="noopener">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" target="_blank" rel="noopener" class="dsq-brlink">Blog comments powered by <span class="logo-disqus">Disqus</span></a></div></article><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.css"><script src="//cdn.bootcss.com/jquery/2.0.3/jquery.min.js"></script><script src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js"></script><script>$(document).ready(function() {
  $(".fancybox").fancybox();
});
</script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=
function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;
e=o.createElement(i);r=o.getElementsByTagName(i)[0];
e.src='//www.google-analytics.com/analytics.js';
r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));
ga('create','UA-156431110-1');ga('send','pageview');</script></body></html>