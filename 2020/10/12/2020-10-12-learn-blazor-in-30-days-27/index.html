<!DOCTYPE html><html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="你好，我是米歐，歡迎來到我的部落格:)"><meta property="og:title" content="MMiooiMM"><meta property="og:description" content="你好，我是米歐，歡迎來到我的部落格:)"><meta property="og:image" content="https://raw.githubusercontent.com/MMiooiMM/MMiooiMM.github.io/master/images/VeryImportantFile.jpg"><title>大內魔術 Blazor - 誰說前端一定要寫JS - Day 27 多國語系魔術 | MMiooiMM</title><link rel="stylesheet" type="text/css" href="/css/normalize.css"><link rel="stylesheet" type="text/css" href="/css/highlight.css"><link rel="stylesheet" type="text/css" href="/css/font.css"><link rel="stylesheet" type="text/css" href="/css/noise.css"><link rel="stylesheet" type="text/css" href="/css/mio.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><meta name="generator" content="Hexo 4.2.1"></head><body><article class="wrapper"><div class="post-main"><div class="nav"><nav class="container"><a class="sidebar-nav-item active" href="/">Home</a><a class="sidebar-nav-item" href="/archives">Archives</a><a class="sidebar-nav-item" href="/about">About</a></nav><div class="container post-meta"><div class="post-tags"><a class="post-tag-link" href="/tags/Blazor/" rel="tag">Blazor</a><a class="post-tag-link" href="/tags/CSharp/" rel="tag">CSharp</a><a class="post-tag-link" href="/tags/%E7%AC%AC-12-%E5%B1%86-iThome-%E9%90%B5%E4%BA%BA%E8%B3%BD/" rel="tag">第 12 屆 iThome 鐵人賽</a></div><div class="post-time">2020-10-12</div></div></div><div class="container post-header"><h1>大內魔術 Blazor - 誰說前端一定要寫JS - Day 27 多國語系魔術</h1></div><div class="container post-content"><p>今天要來介紹多國語系的處理，想要建立一個國際化網站，多國語系可以說是基本需求，那我們就來看如何在 Blazor 中實現吧！</p>
<hr>
<p>除了數字與日期格式有原先 .NET 框架的文化特性外，其他都要自己來處理多國語系的範本，這也是理所當然的，除非機器翻譯的準確率接近完美，否則公司大可花錢請人翻譯，以免在公開網站出現奇葩內容。</p>
<p>那麼我們該如何在 Blazor wasm 中實現多國語系呢？很遺憾官方目前並沒有提供一份詳細的文件，但留了一個 Repository 來供我們參考，讓我們以<a href="https://github.com/pranavkm/LocSample" target="_blank" rel="noopener">pranavkm/LocSample</a>的方式來當作多國語系的處理吧！</p>
<p>首先針對需要多國語系的元件建立資源檔，其檔案名稱如 <code>{Component}.{Culture}.resx</code>，<code>Component</code> 為使用此資源檔的元件名稱，需確保名稱與元件名稱一致，<code>Culture</code> 為文化特性的值，若不加則代表預設的資源檔。</p>
<p>因為 <code>.resx</code> 屬於 XML 格式的檔案，所以這邊就不貼 Code 了，建立 <code>{Component.resx}</code> 且擁有 <code>Greetings</code> 欄位其值為 <code>你好！</code>，並建立 <code>{Component}.en.resx</code> 且擁有 <code>Greetings</code> 欄位其值為 <code>Hello!</code>。</p>
<p>在 <code>Component</code> 使用資源檔前，需要先從 <code>Nuget</code> 安裝 <code>Microsoft.Extensions.Localization</code>，我們需要透過其命名空間下的 <code>IStringLocalizer&lt;T&gt;</code> 物件來取得資源檔內容，安裝完畢後記得註冊服務 <code>builder.Services.AddLocalization();</code>，註冊時 <code>AddLocalization</code> 方法也提供 <code>LocalizationOptions</code> 來設定額外內容，雖然目前只有提供 <code>ResourcesPath</code> 來修改資源檔定位的相關路徑。</p>
<p>然後就可以在元件注入 <code>IStringLocalizer&lt;T&gt;</code> 來存取相關的資源檔，如：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">@* Day27Sample.razor *@</span><br><span class="line">@inject Microsoft.Extensions.Localization.IStringLocalizer&lt;Day27Sample&gt; Loc</span><br><span class="line">&lt;h1&gt;@Loc[<span class="string">"Greetings"</span>]&lt;/h1&gt;</span><br></pre></td></tr></table></figure>

<p>為了提供使用者切換文化特性，需要建立一個選擇文化特性的元件：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">@* CultureSelector.razor *@</span><br><span class="line">@<span class="keyword">using</span>  System.Globalization</span><br><span class="line">@inject IJSRuntime JSRuntime</span><br><span class="line">@inject NavigationManager Nav</span><br><span class="line"></span><br><span class="line">&lt;strong&gt;Culture:&lt;/strong&gt;</span><br><span class="line">&lt;<span class="keyword">select</span> @bind=<span class="string">"Culture"</span>&gt;</span><br><span class="line">    @<span class="keyword">foreach</span> (<span class="keyword">var</span> culture <span class="keyword">in</span> supportedCultures)</span><br><span class="line">    &#123;</span><br><span class="line">        &lt;option <span class="keyword">value</span>=<span class="string">"@culture"</span>&gt;@culture.DisplayName&lt;/option&gt;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/<span class="keyword">select</span>&gt;</span><br><span class="line"></span><br><span class="line">@code</span><br><span class="line">&#123;</span><br><span class="line">  CultureInfo[] supportedCultures = <span class="keyword">new</span>[]</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">new</span> CultureInfo(<span class="string">"zh-TW"</span>),</span><br><span class="line">    <span class="keyword">new</span> CultureInfo(<span class="string">"en-US"</span>),</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  CultureInfo Culture</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">get</span> =&gt; CultureInfo.CurrentCulture;</span><br><span class="line">    <span class="keyword">set</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> (CultureInfo.CurrentCulture != <span class="keyword">value</span>)</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">var</span> js = (IJSInProcessRuntime)JSRuntime;</span><br><span class="line">        js.InvokeVoid(<span class="string">"blazorCulture.set"</span>, <span class="keyword">value</span>.Name);</span><br><span class="line">        Nav.NavigateTo(Nav.Uri, forceLoad: <span class="literal">true</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>但因為注入後就會被初始化，所以我們一定要透過網頁重啟，來使文化特性在初始化時能以使用者選擇的文化特性，所以我們需要藉由 <code>localStorage</code> 來保存使用者修改文化特性時的值，並且在重新啟動時取得該值：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Program.cs</span></span><br><span class="line"><span class="keyword">var</span> host = builder.Build();</span><br><span class="line"><span class="keyword">var</span> jsInterop = host.Services.GetRequiredService&lt;IJSRuntime&gt;();</span><br><span class="line"><span class="keyword">var</span> result = <span class="keyword">await</span> jsInterop.InvokeAsync&lt;<span class="keyword">string</span>&gt;(<span class="string">"blazorCulture.get"</span>);</span><br><span class="line"><span class="keyword">if</span> (result != <span class="literal">null</span>)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">var</span> culture = <span class="keyword">new</span> CultureInfo(result);</span><br><span class="line">  CultureInfo.DefaultThreadCurrentCulture = culture;</span><br><span class="line">  CultureInfo.DefaultThreadCurrentUICulture = culture;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>JS 內容為：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">window</span>.blazorCulture = &#123;</span><br><span class="line">    <span class="keyword">get</span>: () =&gt; window.localStorage['BlazorCulture'],</span><br><span class="line">    <span class="keyword">set</span>: (value) =&gt; window.localStorage['BlazorCulture'] = value</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>這樣只要在合適的地方使用 <code>CultureSelector</code> 元件選擇文化特性，就能透過重新載入的方式使全站語系變更，且之後的每一次進入都可以看到相同的內容，除非使用者自行清除。</p>
<hr>
<p>以上就是多國語系的處理方式，美中不足的是這套一定要使用 <code>.resx</code> 來當作資源檔，沒辦法使用 <code>.json</code> 來處理，但 Blazor 也算是個新興框架吧？相信未來會有更多的解決辦法！完整程式碼在<a href="https://github.com/MMiooiMM/learn-blazor-in-30-days-sample/commit/5a0c0fb47363d24568dd2ee97df83e4795eeb1ea" target="_blank" rel="noopener">範本程式碼 - Day27</a>。</p>
<p>感謝大家的閱讀，我們明天見。</p>
<p>參考資料<br><a href="https://docs.microsoft.com/zh-tw/aspnet/core/blazor/globalization-localization?view=aspnetcore-3.1" target="_blank" rel="noopener">ASP.NET Core Blazor 全球化和當地語系化</a><br><a href="https://github.com/pranavkm/LocSample" target="_blank" rel="noopener">pranavkm/LocSample</a></p>
</div></div><div class="post-main post-comment"><div id="disqus_thread"></div><script type="text/javascript">
var disqus_shortname = 'mio-blog';
var disqus_identifier = '2020/10/12/2020-10-12-learn-blazor-in-30-days-27/';
var disqus_title = '大內魔術 Blazor - 誰說前端一定要寫JS - Day 27 多國語系魔術';
var disqus_url = 'http://yoursite.com/2020/10/12/2020-10-12-learn-blazor-in-30-days-27/';
(function() {
   var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
   dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
   (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript" target="_blank" rel="noopener">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" target="_blank" rel="noopener" class="dsq-brlink">Blog comments powered by <span class="logo-disqus">Disqus</span></a></div></article><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.css"><script src="//cdn.bootcss.com/jquery/2.0.3/jquery.min.js"></script><script src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js"></script><script>$(document).ready(function() {
  $(".fancybox").fancybox();
});
</script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=
function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;
e=o.createElement(i);r=o.getElementsByTagName(i)[0];
e.src='//www.google-analytics.com/analytics.js';
r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));
ga('create','UA-156431110-1');ga('send','pageview');</script></body></html>